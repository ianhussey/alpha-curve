---
title: "Data extraction"
output: html_document
---

# TODO

- NA

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Dependencies

```{r}

library(tidyverse)
library(stringr)
library(httr)

```

# Data

```{r}

data_fulltexts <- read_rds("../../data/raw/psychology/data_fulltexts.rds")

```

# Detect strings

```{r}

data_measurement_terms <- data_fulltexts |> 
  mutate(
    validity                     = str_detect(string = text, pattern = "validity"),
    criterion_validity           = str_detect(string = text, pattern = "criterion validity"),
    structural_validity          = str_detect(string = text, pattern = "structural validity"),
    convergent_validity          = str_detect(string = text, pattern = "convergent validity"), 
    discriminant_validity        = str_detect(string = text, pattern = "discriminant validity"),
    construct_validity           = str_detect(string = text, pattern = "construct validity"),
    face_validity                = str_detect(string = text, pattern = "face validity"),
    content_validity             = str_detect(string = text, pattern = "content validity"),
    predictive_validity          = str_detect(string = text, pattern = "predictive validity"),
    internal_validity            = str_detect(string = text, pattern = "internal validity"),
    external_validity            = str_detect(string = text, pattern = "external validity"),
    concurrent_validity          = str_detect(string = text, pattern = "concurrent validity"),
    
    reliability                  = str_detect(string = text, pattern = "reliability"),
    
    internal_reliability         = str_detect(string = text, pattern = "internal reliabilit"),
    internal_consistency         = str_detect(string = text, pattern = "internal consistenc"),
    test_retest                  = str_detect(string = text, pattern = "test( |-)retest"),
    test_retest_reliability      = str_detect(string = text, pattern = "test( |-)retest reliabilit"),
    split_half                   = str_detect(string = text, pattern = "(split half|split-half|splithalf)"),
    split_half_reliability       = str_detect(string = text, pattern = "(split half|split-half|splithalf) reliability"),
    
    cronbach                     = str_detect(string = text, pattern = "cronbach"),
    alpha                        = str_detect(string = text, pattern = "(alpha|α)"),
    cronbach_alpha               = str_detect(string = text, pattern = "cronbach('|’)?s? (alpha|a|α)"),
    coefficient_alpha            = str_detect(string = text, pattern = "coefficient (alpha|a|α)"),
    
    mcdonalds_omega              = str_detect(string = text, pattern = "mcdonald('|’)?s? (omega|ω)"),
    omega                        = str_detect(string = text, pattern = "(omega|ω)"),
    factor_analys                = str_detect(string = text, pattern = "factor analys"),
    exploratory_factor_analys    = str_detect(string = text, pattern = "exploratory factor analys"),
    confirmatory_factor_analys   = str_detect(string = text, pattern = "confirmatory factor analys"),
    network_analys               = str_detect(string = text, pattern = "network analys"),
    measurement_invarian         = str_detect(string = text, pattern = "measurement invarian"),
    factor_structure             = str_detect(string = text, pattern = "factor structure"),
    dimensionality               = str_detect(string = text, pattern = "dimensionality"),
    unidimensionality            = str_detect(string = text, pattern = "unidimensional")
  ) |>
  select(-text)

```

# Results

```{r}

data_measurement_terms |>
  count()

data_measurement_terms |>
  select(-doi) |>
  summarize_all(mean) |>
  mutate_all(round, digits = 2) |>
  gather() |>
  arrange(desc(value))

```

# Write to disk

```{r}

write_rds(data_measurement_terms, "../../data/processed/psychology/data_measurement_terms.rds")
#data_measurement_terms <- read_rds("../../data/processed/psychology/data_measurement_terms.rds")

```

# Session info

```{r}

sessionInfo()

```


